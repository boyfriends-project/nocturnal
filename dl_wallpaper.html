<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">

<!-- フォント読み込み -->
<link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New&display=swap" rel="stylesheet">

<title>特典DLページ</title>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-587TGTD330"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-587TGTD330');
</script>

<meta name="viewport" content="width=device-width,initial-scale=1.0">


  <style>
  body {
    font-family: sans-serif;
    background: #ddd6fe;
    color: #4b3f72;
    text-align: center;
    margin: 0;
    padding: 20px;
  }
  h1 { margin-bottom: 20px; }

  .gallery{
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
  }
  .gallery img{
    width: 100%;
    max-width: 200px;
    border-radius: 8px;
    cursor: pointer;
    transition: transform .2s;
  }
  .gallery img:hover{ transform: scale(1.05); }

  /* ===== モーダル（中央ズレ対策・安全領域対応） ===== */
.modal{
  display: none;
  position: fixed;
  inset: 0;
  z-index: 999;
  background: rgba(0,0,0,0.9);
  box-sizing: border-box;
  padding: max(12px, env(safe-area-inset-top))
           max(12px, env(safe-area-inset-right))
           max(12px, env(safe-area-inset-bottom))
           max(12px, env(safe-area-inset-left));
  justify-content: center; /* 中央寄せ */
  align-items: center;
}
 .modal.open{
  display: flex;   /* Flexboxで中央配置 */
}
/* 画像＋DLボタンを縦にまとめるコンテナ */
.modal-content{
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 14px;       /* 画像とボタンの間隔 */
  max-height: 90vh;
}

.modal-content img{
  max-width: 92vw;
  max-height: 75vh;   /* 画像は画面に収まるよう調整 */
  border-radius: 10px;
  object-fit: contain;
}
  .modal img{
    display: block;
    max-width: min(92vw, 1200px);
    max-height: 76vh;        /* 画面に収まる高さ */
    height: auto;
    margin: 0;               /* 余白が中心計算に影響しないように */
    border-radius: 10px;
    object-fit: contain;
  }

  /* 閉じるボタンはレイアウトに影響させない（固定配置） */
  #close{
    position: fixed;
    top: max(12px, env(safe-area-inset-top));
    right: max(12px, env(safe-area-inset-right));
    font-size: 40px;
    color: #fff;
    cursor: pointer;
    line-height: 1;
  }

  /* モーダル内のDLボタンは中央下に自然に配置 */
  #modal-download{
  margin: 0; /* 下すぎないように余白リセット */
}

  /* ===== ボタン（既存デザイン踏襲） ===== */
.dlBtn{
  appearance:none;
  border:0;
  border-radius:8px;
  padding:10px 14px;
  background:#c4a3ff;
  color:#fff;
  font-weight:700;
  text-decoration:none;
  display:inline-flex;
  gap:5px;
  align-items:center;
  box-shadow:0 4px 14px rgba(255,77,141,.35);
}

/* クリック中や処理中（pointer-events:none が付与された時）の見た目 */
.dlBtn[style*="pointer-events: none"] {
  opacity: .85;
}
  .dlBtn:hover{ background:#e73370; }
  .dlBtn.disabled{ pointer-events:none; opacity:.6; }

  .bulk-download{ margin:14px 0 22px; }
  .bulk-download .dlBtn{ display:inline-flex;align-items:center;gap:.5rem; }

  .lead{ color:var(--muted); margin:0 0 20px; font-size:14px; }

  @media (max-width: 480px){
    body{ padding: 16px; }
  }
.dlBtn.disabled {
  pointer-events: none;
  opacity: .85;
}

</style>


<base href="https://boyfriends-project.github.io/nocturnal/">

</head>
<body>
  <h1>スマホ用壁紙DLページ</h1>

    <p class="lead">📦 まとめてダウンロード（ZIP形式）では<strong>ZIP解凍アプリ</strong>が必要な場合があります。<br>　App Store / Google Play などでアプリをご準備の上、ダウンロードして下さい。</p>

<div class="bulk-download">
  <a id="bulk-download" class="dlBtn"
     href="images/dl/wallpapers.zip" download>
    📦 壁紙20枚をまとめてダウンロード
  </a>
</div>

  <!-- サムネ一覧 -->
  <div class="gallery">
    <img src="images/god/ルビー神.webp" data-full="images/dl/紅焔の戦神アグニオス.webp" alt="神さま01" loading="lazy">
    <img src="images/god/セレナイト神.webp" data-full="images/dl/月光の導神セレヴィス.webp" alt="神さま02" loading="lazy">
<img src="images/god/サファイア神.webp" data-full="images/dl/夢紡ぎの幻神ノクティス.webp" alt="神さま03" loading="lazy">
    <img src="images/god/アンバー神.webp" data-full="images/dl/海皇神ナギノミコト.webp" alt="神さま04" loading="lazy">
    <img src="images/god/ガーネット神.webp" data-full="images/dl/契約の冥王タナクリス.webp" alt="神さま05" loading="lazy">

    <img src="images/god/ホワイトラブラドライト神.webp" data-full="images/dl/光虹の橋神グリムルスト.webp" alt="神さま06" loading="lazy">
    <img src="images/god/ラリマー神.webp" data-full="images/dl/蒼環の守帝エリュシオン.webp" alt="神さま07" loading="lazy">

<img src="images/god/トパーズ神.webp" data-full="images/dl/陽翔の聖神ヘリオディス.webp" alt="神さま08" loading="lazy">
    <img src="images/god/レッドコーラル神.webp" data-full="images/dl/海哭の大神司ジュンユー.webp" alt="神さま09" loading="lazy">
    <img src="images/god/パール神.webp" data-full="images/dl/天珠の龍神ユンロン.webp" alt="神さま10" loading="lazy">

    <img src="images/god/アクアマリン神.webp" data-full="images/dl/深碧の導星エドワルド.webp" alt="神さま11" loading="lazy">
    <img src="images/god/イエローカルサイト神.webp" data-full="images/dl/道拓の神カジノミコト.webp" alt="神さま12" loading="lazy">
<img src="images/god/インカローズ神.webp" data-full="images/dl/紅誓の覇将軍ハオラン.webp" alt="神さま13" loading="lazy">
    <img src="images/god/ムーンストーン神.webp" data-full="images/dl/星環の星神アストリオス.webp" alt="神さま14" loading="lazy">
    <img src="images/god/ラピスラズリ神.webp" data-full="images/dl/賢翼の空神オルニクス.webp" alt="神さま15" loading="lazy">

    <img src="images/god/タイガーアイ神.webp" data-full="images/dl/虎眼の覇神レグナス.webp" alt="神さま16" loading="lazy">
    <img src="images/god/レッドカーネリアン神.webp" data-full="images/dl/光響の歌神ミカヅオト.webp" alt="神さま17" loading="lazy">

<img src="images/god/ロッククリスタル神.webp" data-full="images/dl/氷鏡の大霊ヴェリミール.webp" alt="神さま18" loading="lazy">
    <img src="images/god/セレスタイト神.webp" data-full="images/dl/轟天の雷帝ライホウ.webp" alt="神さま19" loading="lazy">
    <img src="images/god/シトリン神.webp" data-full="images/dl/皇神ヒカリカゲノミコト.webp" alt="神さま20" loading="lazy">
    <!-- 必要な分だけ追加 -->
  </div>
<p>※この壁紙は「WebP形式」です。ほぼすべてのスマホで通常の壁紙と同じように使えます。<br>
もし古い端末で使えない場合は、PNGに変換してお試しください。</p>


  <!-- モーダル -->
  <div id="modal" class="modal">
  <span id="close">&times;</span>
  <div class="modal-content">
    <img id="modal-img" src="" alt="">
    <a id="modal-download" class="dlBtn" href="#" download>📥 ダウンロード</a>
  </div>
</div>

<script>
  const modal = document.getElementById("modal");
  const modalImg = document.getElementById("modal-img");
  const modalDownload = document.getElementById("modal-download");
  const closeBtn = document.getElementById("close");

  // 環境判定
  const isProd = /boyfriends-project\.github\.io$/i.test(location.hostname);
  const isLocalLike =
    location.protocol === "file:" ||
    location.hostname === "localhost" ||
    location.hostname === "127.0.0.1" ||
    location.hostname === "";

  function fileNameFrom(path, fallback="wallpaper.webp"){
    try {
      const name = decodeURIComponent((path.split('/').pop()||"").split("?")[0]);
      return name || fallback;
    } catch { return fallback; }
  }

  function openModal(previewSrc, fullSrc){
    const src = fullSrc || previewSrc;
    const safe = encodeURI(src);
    modal.classList.add("open");
    modalImg.src = safe;

    // 本番では a[download] に任せる
    modalDownload.href = safe;
    modalDownload.setAttribute("download", fileNameFrom(src));
    modalDownload.textContent = "📥 ダウンロード";

    document.body.style.overflow = "hidden";
  }

  function closeModal(){
    modal.classList.remove("open");
    modalImg.src = "";
    document.body.style.overflow = "";
  }

  // ギャラリー → モーダル
  document.querySelectorAll(".gallery img").forEach(img => {
    img.addEventListener("click", () => openModal(img.dataset.preview, img.dataset.full));
  });

  closeBtn.addEventListener("click", closeModal);
  modal.addEventListener("click", (e) => { if (e.target === modal) closeModal(); });

  // ---- ローカル環境だけ：遷移を止めてBlob保存を“試行”、失敗時は新規タブで表示 ----
  if (!isProd && isLocalLike) {
    async function forceDownload(url, filename){
      // 失敗しやすいので、ダメならフォールバックする
      try {
        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const blob = await res.blob();
        const blobUrl = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = blobUrl;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(blobUrl);
        return true;
      } catch (e) {
        return false;
      }
    }

    modalDownload.addEventListener("click", async (e) => {
      e.preventDefault(); // 遷移を止める（ローカルのみ）
      const url = modalDownload.href;
      const name = fileNameFrom(url);
      // Blob保存を試す → ダメなら新規タブで開く
      const ok = await forceDownload(url, name);
      if (!ok) window.open(url, "_blank");
    }, { passive:false });
  }


// ① クリックしたら数秒だけメッセージを出す小さなヘルパー
function attachDLFeedback(a){
  if (!a) return;
  a.addEventListener("click", () => {
    // 既に表示中なら重ねない
    if (a.dataset.busy === "1") return;
    const label = a.textContent;
    a.dataset.busy = "1";
    a.textContent = "✅ ダウンロード開始（通知/ファイルアプリを確認）";
    a.classList.add("disabled");
setTimeout(() => {
  a.textContent = label;
  a.classList.remove("disabled");   // ← disabledクラスを外して元に戻す
}, 1500);
  }, { passive: true });
}

// ② モーダル内ボタンと、（あれば）まとめDLのボタンにも付与
attachDLFeedback(document.getElementById("modal-download"));
document.querySelectorAll(".bulk-download .dlBtn").forEach(attachDLFeedback);
</script>

<p>
  <a class="dlBtn" href="dl_music.html">ToneのDLページへ行く</a>
</p>

</body>
</html>

