<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">

<!-- フォント読み込み -->
<link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New&display=swap" rel="stylesheet">

<title>特典DLページ</title>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-587TGTD330"></script>

<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-587TGTD330');
</script>

<meta name="viewport" content="width=device-width,initial-scale=1.0">


  <style>
    body {
      font-family: sans-serif;
      background: #ddd6fe;
      color: #4b3f72;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    h1 { margin-bottom: 20px; }
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }
    .gallery img {
      width: 100%;
      max-width: 200px;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .gallery img:hover {
      transform: scale(1.05);
    }
 .modal{
  display: none;              /* ← 初期は非表示 */
  position: fixed;
  z-index: 999;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.9);
  justify-content: center;    /* ← ここはopen時に効く */
  align-items: center;
  flex-direction: column;
  padding: 20px;
}
.modal.open{
  display: flex;              /* ← 開く時だけ表示 */
}
    .modal img {
      max-width: 90%;
      max-height: 70%;
      margin-bottom: 20px;
      border-radius: 10px;
    }
    #close {
      position: absolute;
      top: 20px; right: 40px;
      font-size: 40px;
      color: #fff;
      cursor: pointer;
    }
/* 既存の #download, .dlBtn へのスタイルは .dlBtn に統一推奨 */
.dlBtn{
  appearance:none;border:0;border-radius:8px;padding:10px 14px;
  background:#c4a3ff;color:#fff;font-weight:700;text-decoration:none;
  display:inline-flex;gap:5px;align-items:center;box-shadow:0 4px 14px rgba(255,77,141,.35)
}
.dlBtn:hover{ background:#e73370; }.bulk-download{margin:14px 0 22px}
.bulk-download .dlBtn{display:inline-flex;align-items:center;gap:.5rem}

.dlBtn.disabled { pointer-events: none; opacity: .6; }

  </style>

<base href="https://boyfriends-project.github.io/nocturnal/">

</head>
<body>
  <h1>スマホ用壁紙DLページ</h1>
※保存したい場合は、画面のメニューから「外部ブラウザで開く」や「デフォルトのブラウザで開く」（iPhoneは「Safariで開く」） を選んでください。<br>


<div class="bulk-download">
  <a id="bulk-download" class="dlBtn"
     href="images/dl/wallpapers.zip" download>
    📦 壁紙20枚をまとめてダウンロード
  </a>
</div>

  <!-- サムネ一覧 -->
  <div class="gallery">
    <img src="images/god/ルビー神.webp" data-full="images/dl/紅焔の戦神アグニオス.webp" alt="神さま01" loading="lazy">
    <img src="images/god/セレナイト神.webp" data-full="images/dl/月光の導神セレヴィス.webp" alt="神さま02" loading="lazy">
<img src="images/god/サファイア神.webp" data-full="images/dl/夢紡ぎの幻神ノクティス.webp" alt="神さま03" loading="lazy">
    <img src="images/god/アンバー神.webp" data-full="images/dl/海皇神ナギノミコト.webp" alt="神さま04" loading="lazy">
    <img src="images/god/ガーネット神.webp" data-full="images/dl/契約の冥王タナクリス.webp" alt="神さま05" loading="lazy">

    <img src="images/god/ホワイトラブラドライト神.webp" data-full="images/dl/光虹の橋神グリムルスト.webp" alt="神さま06" loading="lazy">
    <img src="images/god/ラリマー神.webp" data-full="images/dl/蒼環の守帝エリュシオン.webp" alt="神さま07" loading="lazy">

<img src="images/god/トパーズ神.webp" data-full="images/dl/陽翔の聖神ヘリオディス.webp" alt="神さま08" loading="lazy">
    <img src="images/god/レッドコーラル神.webp" data-full="images/dl/海哭の大神司ジュンユー.webp" alt="神さま09" loading="lazy">
    <img src="images/god/パール神.webp" data-full="images/dl/天珠の龍神ユンロン.webp" alt="神さま10" loading="lazy">

    <img src="images/god/アクアマリン神.webp" data-full="images/dl/深碧の導星エドワルド.webp" alt="神さま11" loading="lazy">
    <img src="images/god/イエローカルサイト神.webp" data-full="images/dl/道拓の神カジノミコト.webp" alt="神さま12" loading="lazy">
<img src="images/god/インカローズ神.webp" data-full="images/dl/紅誓の覇将軍ハオラン.webp" alt="神さま13" loading="lazy">
    <img src="images/god/ムーンストーン神.webp" data-full="images/dl/星環の星神アストリオス.webp" alt="神さま14" loading="lazy">
    <img src="images/god/ラピスラズリ神.webp" data-full="images/dl/賢翼の空神オルニクス.webp" alt="神さま15" loading="lazy">

    <img src="images/god/タイガーアイ神.webp" data-full="images/dl/虎眼の覇神レグナス.webp" alt="神さま16" loading="lazy">
    <img src="images/god/レッドカーネリアン神.webp" data-full="images/dl/光響の歌神ミカヅオト.webp" alt="神さま17" loading="lazy">

<img src="images/god/ロッククリスタル神.webp" data-full="images/dl/氷鏡の大霊ヴェリミール.webp" alt="神さま18" loading="lazy">
    <img src="images/god/セレスタイト神.webp" data-full="images/dl/轟天の雷帝ライホウ.webp" alt="神さま19" loading="lazy">
    <img src="images/god/シトリン神.webp" data-full="images/dl/皇神ヒカリカゲノミコト.webp" alt="神さま20" loading="lazy">
    <!-- 必要な分だけ追加 -->
  </div>
<p>※この壁紙は「WebP形式」です。ほぼすべてのスマホで通常の壁紙と同じように使えます。<br>
もし古い端末で使えない場合は、PNGに変換してお試しください。</p>


  <!-- モーダル -->
  <div id="modal" class="modal">
    <span id="close">&times;</span>
    <img id="modal-img" src="" alt="">
    <a id="modal-download" class="dlBtn" href="" download>📥 ダウンロード</a>
</div>

<script>
  const modal = document.getElementById("modal");
  const modalImg = document.getElementById("modal-img");
  const modalDownload = document.getElementById("modal-download"); // モーダル内のDLボタン
  const closeBtn = document.getElementById("close");

  // 文字化けを避けてファイル名を作る
  function fileNameFrom(path, fallback="wallpaper.webp"){
    try {
      const name = decodeURIComponent(path.split('/').pop() || "");
      return name || fallback;
    } catch {
      return fallback;
    }
  }

  // 404簡易チェック（任意）
  async function exists(url){
    try {
      const res = await fetch(url, { method: "HEAD", cache: "no-store" });
      return res.ok;
    } catch { return false; }
  }

  // ★どのブラウザでもダウンロードさせる関数（Blob経由）
  async function forceDownload(url, filename){
    const res = await fetch(url, { cache: "no-store" });
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    const blob = await res.blob();
    const blobUrl = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = blobUrl;
    a.download = filename;
    // iOS対策：同タブでOK。新規タブが必要なら target="_blank" を付ける
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(blobUrl);
  }

  function openModal(previewSrc, fullSrc){
    const src = fullSrc || previewSrc;
    const safe = encodeURI(src);             // 日本語ファイル名を安全に
    modal.classList.add("open");
    modalImg.src = safe;

    // ボタンの既定href（フォールバックとして残す）
    modalDownload.href = safe;
    modalDownload.setAttribute("download", fileNameFrom(src));
    modalDownload.textContent = "📥 ダウンロード";
    modalDownload.classList.remove("disabled");

    document.body.style.overflow = "hidden";
  }

  function closeModal(){
    modal.classList.remove("open");
    modalImg.src = "";
    document.body.style.overflow = "";
  }

  // ギャラリーの画像クリックでモーダルを開く
  document.querySelectorAll(".gallery img").forEach(img => {
    img.addEventListener("click", () => openModal(img.dataset.preview, img.dataset.full));
  });

  // ✨ ここが重要：DLボタンは強制ダウンロードを実行
  modalDownload.addEventListener("click", async (e) => {
    // a[href]の既定遷移を止めて、確実にダウンロードさせる
    e.preventDefault();
    const url = modalDownload.href;
    const name = fileNameFrom(url);
    modalDownload.textContent = "⏳ 準備中…";
    modalDownload.classList.add("disabled");
    try {
      // 存在チェック（任意）
      if (!(await exists(url))) throw new Error("not-found");
      await forceDownload(url, name);
      modalDownload.textContent = "✅ ダウンロード完了";
    } catch(err){
      modalDownload.textContent = "⚠️ ダウンロードできません";
      console.error(err);
    } finally {
      setTimeout(() => {
        modalDownload.textContent = "📥 ダウンロード";
        modalDownload.classList.remove("disabled");
      }, 1500);
    }
  });

  closeBtn.addEventListener("click", closeModal);
  modal.addEventListener("click", (e) => { if (e.target === modal) closeModal(); });
</script>


<p>
  <a class="dlBtn" href="dl_music.html">ToneのDLページへ行く</a>
</p>

</body>
</html>

